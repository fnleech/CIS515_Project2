%% Haar Inverse Step 
% Write a function haar inv step inverting the function haar step. The function haar inv step takes as input a vector v and the number of rounds k.
function [unew] = haar_inv_step(v,k)
n = length(v);
kmax = log2(n) + 1;
if k > kmax
    disp('out of range, reset k');
    k = kmax;
end

for i = 1:k 
    v = haar_inv_step_sub(v, i, n);
end

unew = v;
end

function [mnew] = haar_inv_step_sub(m, k, n)
if k == 1
    mnew = m;
else 
    dv = 2^(k - 2); 
    index = n / dv;
    mtemp = m(1:index);
    modd = mtemp(1:2:index);
    meven = mtemp(2:2:index);
    mnew = [(modd + meven) / 2, (modd - meven) / 2, m((index+1):end)];  
end
end